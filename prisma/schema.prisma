generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id        String    @id @db.Uuid
  email     String    @unique
  role      UserRole  @default(alumni)
  createdAt DateTime? @default(dbgenerated("timezone('utc'::text, now())")) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime? @default(dbgenerated("timezone('utc'::text, now())")) @map("updated_at") @db.Timestamptz(6)

  @@map("users")
}

model AlumniProfile {
  id                   String                @id @db.Uuid
  fullName             String                @map("full_name")
  batchYear            Int                   @map("batch_year")
  currentLocation      String?               @map("current_location")
  occupation           String?
  company              String?
  bio                  String?
  linkedinUrl          String?               @map("linkedin_url")
  isPublic             Boolean?              @default(false) @map("is_public")
  createdAt            DateTime?             @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt            DateTime?             @default(now()) @map("updated_at") @db.Timestamptz(6)
  phone                String?
  email                String?
  instagramUrl         String?               @map("instagram_url")
  facebookUrl          String?               @map("facebook_url")
  showContactInfo      Boolean?              @default(false) @map("show_contact_info")
  testimonial          String?
  showTestimonial      Boolean?              @default(true) @map("show_testimonial")
  profilePictureUrl    String?               @map("profile_picture_url")
  showInSuccess        Boolean               @default(false) @map("show_in_success")
  featuredTestimonials FeaturedTestimonial[]
  successStories       SuccessStory[]

  @@index([showInSuccess], map: "idx_alumni_profiles_show_in_success")
  @@map("alumni_profiles")
}

model SportsProgram {
  id                   String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                 String
  category             String?
  coach                String?
  achievements         String?
  description          String?
  ageGroups            String[]               @map("age_groups")
  schedules            Json?
  images               Json?
  created_by           String?                @db.Uuid
  createdAt            DateTime?              @default(now()) @map("created_at") @db.Timestamptz(6)
  updated_by           String?                @db.Uuid
  updatedAt            DateTime?              @default(now()) @map("updated_at") @db.Timestamptz(6)
  is_published         Boolean                @default(true)
  sports_registrations sports_registrations[]

  @@map("sports_programs")
}

model LeadershipMessage {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  role             String
  name             String
  preview          String
  fullMessage      String    @map("full_message")
  order            Int       @map("order")
  createdAt        DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updated_at       DateTime? @default(now()) @db.Timestamptz(6)
  photoUrl         String?   @map("photo_url")
  campus           String?   @default("all")
  displayLocations String[]  @default(["all"]) @map("display_locations")

  @@index([campus], map: "idx_leadership_messages_campus")
  @@index([displayLocations], map: "idx_leadership_messages_display_locations", type: Gin)
  @@map("leadership_messages")
}

model FeaturedTestimonial {
  id              String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  alumniProfileId String?        @map("alumni_profile_id") @db.Uuid
  isVisible       Boolean?       @default(true) @map("is_visible")
  createdAt       DateTime?      @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt       DateTime?      @default(now()) @map("updated_at") @db.Timestamptz(6)
  alumniProfile   AlumniProfile? @relation(fields: [alumniProfileId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("featured_testimonials")
}

model GalleryEvent {
  id                String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title             String
  description       String?
  date              DateTime       @db.Date
  campus            String
  createdAt         DateTime?      @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime?      @default(now()) @map("updated_at") @db.Timestamptz(6)
  primary_image_url String?
  primary_image_id  String?        @db.Uuid
  gallery_images    GalleryImage[]

  @@map("gallery_events")
}

model GalleryImage {
  id             String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  imageUrl       String       @map("image_url")
  caption        String?
  createdAt      DateTime?    @default(now()) @map("created_at") @db.Timestamptz(6)
  eventID        String       @db.Uuid
  gallery_events GalleryEvent @relation(fields: [eventID], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("gallery_images")
}

model Event {
  id                      String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title                   String
  date                    DateTime    @db.Date
  time                    String
  location                String
  description             String
  coverImage              String      @map("cover_image")
  coverImageMobile        String?     @map("cover_image_mobile")
  maxCapacity             Int?        @map("max_capacity")
  createdAt               DateTime?   @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt               DateTime?   @default(now()) @map("updated_at") @db.Timestamptz(6)
  maxGuestsPerRsvp        Int         @default(4) @map("max_guests_per_rsvp")
  requiresAdmissionNumber Boolean     @default(false) @map("requires_admission_number")
  acceptingRsvps          Boolean     @default(true) @map("accepting_rsvps")
  rsvps                   EventRsvp[]

  @@index([acceptingRsvps], map: "idx_events_accepting_rsvps")
  @@map("events")
}

model EventRsvp {
  id                  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  eventId             String?   @map("event_id") @db.Uuid
  userId              String?   @map("user_id") @db.Uuid
  status              String
  guests              Int       @default(1)
  createdAt           DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  admissionNumber     String?   @map("admission_number")
  max_guests_per_rsvp Int?
  updatedAt           DateTime? @default(now()) @map("updated_at") @db.Timestamptz(6)
  students            Student?  @relation(fields: [admissionNumber], references: [admissionNumber], onUpdate: NoAction)
  event               Event?    @relation(fields: [eventId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([eventId, userId])
  @@index([admissionNumber], map: "idx_event_rsvps_admission_number")
  @@index([eventId, admissionNumber], map: "idx_event_rsvps_lookup")
  @@index([eventId, status], map: "idx_event_rsvps_status")
  @@index([updatedAt], map: "idx_event_rsvps_updated_at")
  @@map("event_rsvps")
}

model CalendarEvent {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title            String
  description      String?
  startTime        DateTime  @map("start_time") @db.Timestamptz(6)
  endTime          DateTime  @map("end_time") @db.Timestamptz(6)
  location         String?
  eventType        String    @map("event_type")
  branch           String
  session          String
  isPublic         Boolean   @default(false) @map("is_public")
  syncedWithGoogle Boolean   @default(false) @map("synced_with_google")
  googleEventId    String?   @map("google_event_id")
  createdAt        DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime? @default(now()) @map("updated_at") @db.Timestamptz(6)
  isAllDay         Boolean?  @default(false) @map("is_all_day")
  event_types      EventType @relation(fields: [eventType], references: [value], map: "valid_event_type")

  @@map("calendar_events")
}

model EventType {
  id              String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  value           String          @unique
  label           String
  createdAt       DateTime        @default(dbgenerated("timezone('utc'::text, now())")) @map("created_at") @db.Timestamptz(6)
  calendar_events CalendarEvent[]

  @@map("event_types")
}

model YoutubeVideo {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title       String
  description String?
  embedCode   String    @map("embed_code")
  position    Int       @default(0)
  isVisible   Boolean?  @default(true) @map("is_visible")
  createdAt   DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime? @default(now()) @map("updated_at") @db.Timestamptz(6)

  @@index([position], map: "idx_youtube_videos_position")
  @@map("youtube_videos")
}

model Teacher {
  id                  String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  fullName            String   @map("full_name")
  profile_picture_url String?
  qualifications      String[]
  experienceYears     Int      @map("experience_years")
  designation         String
  department          String?
  bio                 String?
  isVisible           Boolean? @default(true) @map("is_visible")
  createdAt           DateTime @default(dbgenerated("timezone('utc'::text, now())")) @map("created_at") @db.Timestamptz(6)
  updatedAt           DateTime @default(dbgenerated("timezone('utc'::text, now())")) @map("updated_at") @db.Timestamptz(6)
  subject             String[]
  classLevel          String?  @map("class_level")
  photoUrl            String?  @map("photo_url")

  @@index([fullName], map: "idx_teachers_full_name")
  @@index([subject], map: "idx_teachers_subject")
  @@index([classLevel], map: "idx_teachers_class_level")
  @@map("teachers")
}

model LatestUpdate {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  content   String
  isActive  Boolean?  @default(true) @map("is_active")
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime? @default(now()) @map("updated_at") @db.Timestamptz(6)
  link      String?

  @@map("latest_updates")
}

model Testimonial {
  id                String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  sourceType        String    @map("source_type")
  authorName        String    @map("author_name")
  studentName       String?   @map("student_name")
  class             String?
  content           String
  profilePictureUrl String?   @map("profile_picture_url")
  isVisible         Boolean?  @default(false) @map("is_visible")
  createdAt         DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime? @default(now()) @map("updated_at") @db.Timestamptz(6)

  @@index([sourceType, isVisible], map: "idx_testimonials_source_type_visible")
  @@map("testimonials")
}

model Student {
  admissionNumber      String                 @id @map("admission_number")
  fullName             String                 @map("full_name")
  class                String?
  createdAt            DateTime?              @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt            DateTime?              @default(now()) @map("updated_at") @db.Timestamptz(6)
  event_rsvps          EventRsvp[]
  sports_registrations sports_registrations[]

  @@index([admissionNumber], map: "idx_students_admission_lookup")
  @@index([admissionNumber], map: "idx_students_admission_number")
  @@map("students")
}

model SuccessStory {
  id        String        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  title     String
  content   String
  createdAt DateTime?     @default(now()) @map("created_at") @db.Timestamptz(6)
  alumniId  String        @map("alumni_id") @db.Uuid
  createdBy String        @map("created_by") @db.Uuid
  alumni    AlumniProfile @relation(fields: [alumniId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([alumniId], map: "idx_success_stories_alumni_id")
  @@index([createdAt(sort: Desc)], map: "idx_success_stories_created_at")
  @@map("success_stories")
}

model academic_sessions {
  id         String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  value      String   @unique
  label      String
  is_active  Boolean? @default(true)
  created_at DateTime @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
}

model admin_users {
  id         String    @id(map: "management_users_pkey") @db.Uuid
  role       String    @default("manager")
  created_at DateTime? @default(now()) @db.Timestamptz(6)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model sports_registrations {
  id                 String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  admission_number   String
  sport_id           String        @db.Uuid
  medical_conditions String?
  preferred_schedule String
  created_at         DateTime      @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  status             String?       @default("pending")
  students           Student       @relation(fields: [admission_number], references: [admissionNumber], onDelete: NoAction, onUpdate: NoAction)
  sports_programs    SportsProgram @relation(fields: [sport_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([admission_number, sport_id])
}

enum UserRole {
  admin
  alumni

  @@map("user_role")
}

model BlogCategory {
  id          String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String     @unique
  slug        String     @unique
  description String?
  color       String?    @default("#00501B")
  order       Int        @default(0)
  createdAt   DateTime?  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime?  @default(now()) @map("updated_at") @db.Timestamptz(6)
  posts       BlogPost[]

  @@index([slug], map: "idx_blog_categories_slug")
  @@map("blog_categories")
}

model BlogPost {
  id              String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title           String
  slug            String        @unique
  excerpt         String?
  content         String
  featuredImage   String?       @map("featured_image")
  categoryId      String?       @map("category_id") @db.Uuid
  author          String?       @default("The Scholars' Home")
  tags            String[]      @default([])
  metaTitle       String?       @map("meta_title")
  metaDescription String?       @map("meta_description")
  isPublished     Boolean       @default(false) @map("is_published")
  isFeatured      Boolean       @default(false) @map("is_featured")
  viewCount       Int           @default(0) @map("view_count")
  publishedAt     DateTime?     @map("published_at") @db.Timestamptz(6)
  createdAt       DateTime?     @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt       DateTime?     @default(now()) @map("updated_at") @db.Timestamptz(6)
  category        BlogCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull, onUpdate: NoAction)

  @@index([slug], map: "idx_blog_posts_slug")
  @@index([isPublished, publishedAt], map: "idx_blog_posts_published")
  @@index([categoryId], map: "idx_blog_posts_category")
  @@index([isFeatured], map: "idx_blog_posts_featured")
  @@map("blog_posts")
}
